import { onBeforeUnmount, readonly, ref } from 'vue';
export default function ($ldReady, $ldClient, enableStreaming) {
    return function getFlagRef(flagKey, defaultFlagValue) {
        const flagRef = ref($ldReady.value ? $ldClient.variation(flagKey, defaultFlagValue) : defaultFlagValue);
        if (!enableStreaming) {
            return readonly(flagRef);
        }
        const updateFlagRef = (newFlagValue) => flagRef.value = newFlagValue;
        $ldClient.on(`change:${flagKey}`, updateFlagRef);
        onBeforeUnmount(() => $ldClient.off(`change:${flagKey}`, updateFlagRef));
        if (!$ldReady.value) {
            $ldClient.on('ready', () => updateFlagRef($ldClient.variation(flagKey, flagRef.value)));
        }
        return readonly(flagRef);
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0RmxhZ1JlZi5qcyIsInNvdXJjZVJvb3QiOiIuL2xpYi8iLCJzb3VyY2VzIjpbImdldEZsYWdSZWYudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLE1BQU0sS0FBSyxDQUFBO0FBTXBELE1BQU0sQ0FBQyxPQUFPLFdBQVcsUUFBZ0MsRUFBRSxTQUFtQixFQUFFLGVBQXdCO0lBQ3RHLE9BQU8sU0FBUyxVQUFVLENBQUksT0FBZSxFQUFFLGdCQUFvQjtRQUNqRSxNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQTtRQUN2RyxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ3BCLE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1NBQ3pCO1FBRUQsTUFBTSxhQUFhLEdBQUcsQ0FBQyxZQUFxQixFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxHQUFHLFlBQVksQ0FBQTtRQUM3RSxTQUFTLENBQUMsRUFBRSxDQUFDLFVBQVUsT0FBTyxFQUFFLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFDaEQsZUFBZSxDQUFDLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsVUFBVSxPQUFPLEVBQUUsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFBO1FBQ3hFLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFO1lBQ25CLFNBQVMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO1NBQ3hGO1FBQ0QsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDMUIsQ0FBQyxDQUFBO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG9uQmVmb3JlVW5tb3VudCwgcmVhZG9ubHksIHJlZiB9IGZyb20gJ3Z1ZSdcbmltcG9ydCB0eXBlIHsgTERDbGllbnQgfSBmcm9tICdsYXVuY2hkYXJrbHktanMtY2xpZW50LXNkaydcbmltcG9ydCB0eXBlIHsgUmVmIH0gZnJvbSAndnVlJ1xuXG5leHBvcnQgdHlwZSBGbGFnUmVmPFQ+ID0gUmVhZG9ubHk8UmVmPFQ+PlxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJGxkUmVhZHk6IFJlYWRvbmx5PFJlZjxib29sZWFuPj4sICRsZENsaWVudDogTERDbGllbnQsIGVuYWJsZVN0cmVhbWluZzogYm9vbGVhbikge1xuICByZXR1cm4gZnVuY3Rpb24gZ2V0RmxhZ1JlZjxUPihmbGFnS2V5OiBzdHJpbmcsIGRlZmF1bHRGbGFnVmFsdWU/OiBUKTogRmxhZ1JlZjxUPiB7XG4gICAgY29uc3QgZmxhZ1JlZiA9IHJlZigkbGRSZWFkeS52YWx1ZSA/ICRsZENsaWVudC52YXJpYXRpb24oZmxhZ0tleSwgZGVmYXVsdEZsYWdWYWx1ZSkgOiBkZWZhdWx0RmxhZ1ZhbHVlKVxuICAgIGlmICghZW5hYmxlU3RyZWFtaW5nKSB7XG4gICAgICByZXR1cm4gcmVhZG9ubHkoZmxhZ1JlZilcbiAgICB9XG5cbiAgICBjb25zdCB1cGRhdGVGbGFnUmVmID0gKG5ld0ZsYWdWYWx1ZTogdW5rbm93bikgPT4gZmxhZ1JlZi52YWx1ZSA9IG5ld0ZsYWdWYWx1ZVxuICAgICRsZENsaWVudC5vbihgY2hhbmdlOiR7ZmxhZ0tleX1gLCB1cGRhdGVGbGFnUmVmKVxuICAgIG9uQmVmb3JlVW5tb3VudCgoKSA9PiAkbGRDbGllbnQub2ZmKGBjaGFuZ2U6JHtmbGFnS2V5fWAsIHVwZGF0ZUZsYWdSZWYpKVxuICAgIGlmICghJGxkUmVhZHkudmFsdWUpIHtcbiAgICAgICRsZENsaWVudC5vbigncmVhZHknLCAoKSA9PiB1cGRhdGVGbGFnUmVmKCRsZENsaWVudC52YXJpYXRpb24oZmxhZ0tleSwgZmxhZ1JlZi52YWx1ZSkpKVxuICAgIH1cbiAgICByZXR1cm4gcmVhZG9ubHkoZmxhZ1JlZilcbiAgfVxufVxuIl19